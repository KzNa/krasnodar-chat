{"version":3,"sources":["meteor://ğŸ’»app/server/methods/loadNextMessages.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,oBAAkB,SAAC,GAAD,EAAM,GAAN,EAAW,KAAX;AACjB;;MAD4B,QAAM;KAClC;AAAA,aAAS,MAAM,CAAC,MAAP,EAAT;AAEA,eAAa,CAAC,IAAP,CAAY,eAAZ,EAA6B,GAA7B,EAAkC,MAAlC,CAAP;AACC,aAAO,KAAP,CADD;KAFA;AAAA,IAKA,UACC;AAAA,YACC;AAAA,YAAI,CAAJ;OADD;AAAA,MAEA,OAAO,KAFP;KAND;AAUA,QAAG,WAAc,CAAC,QAAQ,CAAC,GAApB,CAAwB,0BAAxB,CAAP;AACC,aAAO,CAAC,MAAR,GAAiB;AAAA,QAAE,YAAY,CAAd;OAAjB,CADD;KAVA;AAaA,QAAG,WAAH;AACC,gBAAU,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,iCAA3B,CAA6D,GAA7D,EAAkE,GAAlE,EAAuE,OAAvE,CAA+E,CAAC,KAAhF,EAAV,CADD;KAAA;AAGC,gBAAU,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,mBAA3B,CAA+C,GAA/C,EAAoD,OAApD,CAA4D,CAAC,KAA7D,EAAV,CAHD;KAbA;AAAA,IAkBA,WAAW,CAAC,CAAC,GAAF,CAAM,OAAN,EAAe,SAAC,OAAD;AACzB,aAAO,CAAC,OAAR,GAAkB,CAAC,CAAC,SAAF,CAAY,OAAO,CAAC,OAApB,EAA6B;AAAA,QAAE,KAAK,MAAP;OAA7B,CAAlB;AACA,aAAO,OAAP,CAFyB;IAAA,CAAf,CAlBX;AAsBA,WAAO;AAAA,MACN,UAAU,QADJ;KAAP,CAvBiB;EAAA,CAAlB;CADD","file":"/server/methods/loadNextMessages.coffee.js","sourcesContent":["Meteor.methods\n\tloadNextMessages: (rid, end, limit=20) ->\n\t\tfromId = Meteor.userId()\n\n\t\tunless Meteor.call 'canAccessRoom', rid, fromId\n\t\t\treturn false\n\n\t\toptions =\n\t\t\tsort:\n\t\t\t\tts: 1\n\t\t\tlimit: limit\n\n\t\tif not RocketChat.settings.get 'Message_ShowEditedStatus'\n\t\t\toptions.fields = { 'editedAt': 0 }\n\n\t\tif end?\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch()\n\t\telse\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch()\n\n\t\tmessages = _.map records, (message) ->\n\t\t\tmessage.starred = _.findWhere message.starred, { _id: fromId }\n\t\t\treturn message\n\n\t\treturn {\n\t\t\tmessages: messages\n\t\t}\n"]}