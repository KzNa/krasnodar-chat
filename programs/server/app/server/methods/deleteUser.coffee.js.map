{"version":3,"sources":["meteor://ðŸ’»app/server/methods/deleteUser.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,cAAY,SAAC,MAAD;AACX;AAAA,QAAG,OAAU,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,cAAb,EAA6B,sCAA7B,CAAV,CADD;KAAA;AAAA,IAGA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAAM,CAAC,MAAP,EAApC,CAHP;AAKA,QAAO,UAAU,CAAC,KAAK,CAAC,aAAjB,CAA+B,MAAM,CAAC,MAAP,EAA/B,EAAgD,aAAhD,MAAkE,IAAzE;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,gBAAb,EAA+B,wCAA/B,CAAV,CADD;KALA;AAAA,IAQA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAApC,CARP;AASA,QAAO,YAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,WAAb,EAA0B,wCAA1B,CAAV,CADD;KATA;AAAA,IAYA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,cAA3B,CAA0C,MAA1C,CAZA;AAAA,IAcA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,YAAhC,CAA6C,MAA7C,CAAoD,CAAC,OAArD,CAA6D,SAAC,YAAD;AAC5D;AAAA,aAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,YAAY,CAAC,GAAjD,CAAP;AACA,UAAG,IAAI,CAAC,CAAL,KAAY,GAAZ,IAAoB,IAAI,CAAC,SAAS,CAAC,MAAf,KAAyB,CAAhD;AACC,kBAAU,CAAC,MAAM,CAAC,KAAK,CAAC,UAAxB,CAAmC,YAAY,CAAC,GAAhD,EADD;OADA;AAGA,UAAG,IAAI,CAAC,CAAL,KAAU,GAAb;AACC,kBAAU,CAAC,MAAM,CAAC,aAAa,CAAC,cAAhC,CAA+C,YAAY,CAAC,GAA5D;eACA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,cAA3B,CAA0C,YAAY,CAAC,GAAvD,EAFD;OAJ4D;IAAA,CAA7D,CAdA;AAAA,IAuBA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,cAAhC,CAA+C,MAA/C,CAvBA;AAAA,IAwBA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,8BAAxB,CAAuD,GAAvD,EAA4D,IAAI,CAAC,QAAjE,CAxBA;AAAA,IAyBA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAxB,CAA8C,IAAI,CAAC,QAAnD,CAzBA;AAAA,IA0BA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,UAAxB,CAAmC,MAAnC,CA1BA;AA4BA,WAAO,IAAP,CA7BW;EAAA,CAAZ;CADD","file":"/server/methods/deleteUser.coffee.js","sourcesContent":["Meteor.methods\n\tdeleteUser: (userId) ->\n\t\tif not Meteor.userId()\n\t\t\tthrow new Meteor.Error('invalid-user', \"[methods] deleteUser -> Invalid user\")\n\n\t\tuser = RocketChat.models.Users.findOneById Meteor.userId()\n\n\t\tunless RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') is true\n\t\t\tthrow new Meteor.Error 'not-authorized', '[methods] deleteUser -> Not authorized'\n\n\t\tuser = RocketChat.models.Users.findOneById userId\n\t\tunless user?\n\t\t\tthrow new Meteor.Error 'not-found', '[methods] deleteUser -> User not found'\n\n\t\tRocketChat.models.Messages.removeByUserId userId # Remove user messages\n\n\t\tRocketChat.models.Subscriptions.findByUserId(userId).forEach (subscription) ->\n\t\t\troom = RocketChat.models.Rooms.findOneById subscription.rid\n\t\t\tif room.t isnt 'c' and room.usernames.length is 1\n\t\t\t\tRocketChat.models.Rooms.removeById subscription.rid # Remove non-channel rooms with only 1 user (the one being deleted)\n\t\t\tif room.t is 'd' \n\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId subscription.rid\n\t\t\t\tRocketChat.models.Messages.removeByRoomId subscription.rid\n\n\n\t\tRocketChat.models.Subscriptions.removeByUserId userId # Remove user subscriptions\n\t\tRocketChat.models.Rooms.removeByTypeContainingUsername 'd', user.username # Remove direct rooms with the user\n\t\tRocketChat.models.Rooms.removeUsernameFromAll user.username # Remove user from all other rooms\n\t\tRocketChat.models.Users.removeById userId # Remove user from users database\n\n\t\treturn true\n"]}