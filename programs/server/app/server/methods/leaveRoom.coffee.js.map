{"version":3,"sources":["meteor://ðŸ’»app/server/methods/leaveRoom.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,aAAW,SAAC,GAAD;AACV;AAAA,eAAa,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,GAAb,EAAkB,qCAAlB,CAAV,CADD;KAAA;AAAA,IAGA,IAAI,CAAC,OAAL,EAHA;AAAA,IAKA,SAAS,MAAM,CAAC,MAAP,EALT;AAAA,IAMA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,GAApC,CANP;AAAA,IAOA,OAAO,MAAM,CAAC,IAAP,EAPP;AAAA,IASA,UAAU,CAAC,SAAS,CAAC,GAArB,CAAyB,iBAAzB,EAA4C,IAA5C,EAAkD,IAAlD,CATA;AAAA,IAWA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,kBAAxB,CAA2C,GAA3C,EAAgD,IAAI,CAAC,QAArD,CAXA;AAaA,QAAG,IAAI,CAAC,CAAL,KAAY,GAAZ,IAAoB,IAAI,CAAC,SAAS,CAAC,OAAf,CAAuB,IAAI,CAAC,QAA5B,MAA2C,EAAlE;AACC,oBAAc,IAAd;AAAA,MAEA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,gCAA3B,CAA4D,GAA5D,EAAiE,WAAjE,CAFA,CADD;KAbA;AAkBA,QAAG,IAAI,CAAC,CAAL,KAAU,GAAb;AACC,gBAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,8BAA3B,CAA0D,QAA1D,EAAoE,GAApE,EAAyE,IAAzE,EADD;KAlBA;AAsBA,qCAAS,CAAE,aAAR,KAAe,MAAM,CAAC,MAAP,EAAlB;AACC,iBAAW,CAAC,CAAC,OAAF,CAAU,IAAI,CAAC,SAAf,EAA0B,IAAI,CAAC,QAA/B,CAAyC,GAApD;AACA,UAAG,gBAAH;AACC,mBAAW,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAxB,CAA0C,QAA1C,CAAX;AAEA,YAAG,gBAAH;AACC,oBAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,GAApC,EAAyC,QAAzC,EADD;SAHD;OAFD;KAtBA;AAAA,IA8BA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,uBAAhC,CAAwD,GAAxD,EAA6D,MAAM,CAAC,MAAP,EAA7D,CA9BA;WAgCA,MAAM,CAAC,KAAP,CAAa;aAEZ,UAAU,CAAC,SAAS,CAAC,GAArB,CAAyB,gBAAzB,EAA2C,IAA3C,EAAiD,IAAjD,EAFY;IAAA,CAAb,EAjCU;EAAA,CAAX;CADD","file":"/server/methods/leaveRoom.coffee.js","sourcesContent":["Meteor.methods\n\tleaveRoom: (rid) ->\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error(403, \"[methods] leaveRoom -> Invalid user\")\n\n\t\tthis.unblock()\n\n\t\tfromId = Meteor.userId()\n\t\troom = RocketChat.models.Rooms.findOneById rid\n\t\tuser = Meteor.user()\n\n\t\tRocketChat.callbacks.run 'beforeLeaveRoom', user, room\n\n\t\tRocketChat.models.Rooms.removeUsernameById rid, user.username\n\n\t\tif room.t isnt 'c' and room.usernames.indexOf(user.username) isnt -1\n\t\t\tremovedUser = user\n\n\t\t\tRocketChat.models.Messages.createUserLeaveWithRoomIdAndUser rid, removedUser\n\n\t\tif room.t is 'l'\n\t\t\tRocketChat.models.Messages.createCommandWithRoomIdAndUser 'survey', rid, user\n\n\n\t\tif room.u?._id is Meteor.userId()\n\t\t\tnewOwner = _.without(room.usernames, user.username)[0]\n\t\t\tif newOwner?\n\t\t\t\tnewOwner = RocketChat.models.Users.findOneByUsername newOwner\n\n\t\t\t\tif newOwner?\n\t\t\t\t\tRocketChat.models.Rooms.setUserById rid, newOwner\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId rid, Meteor.userId()\n\n\t\tMeteor.defer ->\n\n\t\t\tRocketChat.callbacks.run 'afterLeaveRoom', user, room\n"]}