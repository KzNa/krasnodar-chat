{"version":3,"sources":["meteor://ðŸ’»app/server/stream/messages.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,IAAC,UAAD,GAAiB,UAAM,CAAC,MAAP,CAAc,UAAd,CAAjB;;AAAA,SAES,CAAC,WAAW,CAAC,KAAtB,CAA4B,SAAC,SAAD;AAG3B,SAAO,KAAP,CAH2B;AAAA,CAA5B,CAFA;;AAAA,SAOS,CAAC,WAAW,CAAC,IAAtB,CAA2B,SAAC,SAAD;AAI1B;AAAA;AACC,gBAAY,MAAM,CAAC,IAAP,CAAY,eAAZ,EAA6B,SAA7B,EAAwC,IAAI,CAAC,MAA7C,CAAZ;AAEA,QAAgB,UAAhB;AAAA,aAAO,KAAP;KAFA;AAIA,WAAO,IAAP,CALD;GAAA;AAOC,IADK,UACL;AAAA,WAAO,KAAP,CAPD;GAJ0B;AAAA,CAA3B,CAPA;;AAAA,MAqBM,CAAC,OAAP,CAAe;AACd;AAAA,YAAU,EAAV;AAEA,MAAG,WAAc,CAAC,QAAQ,CAAC,GAApB,CAAwB,0BAAxB,CAAP;AACC,WAAO,CAAC,MAAR,GAAiB;AAAA,MAAE,YAAY,CAAd;KAAjB,CADD;GAFA;SAKA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,wCAA3B,CAAwE,UAAxE,EAAgF,OAAhF,CAAwF,CAAC,OAAzF,CACC;AAAA,WAAO,SAAC,MAAD;aACN,SAAS,CAAC,IAAV,CAAe,MAAM,CAAC,GAAtB,EAA2B,MAA3B,EADM;IAAA,CAAP;AAAA,IAGA,SAAS,SAAC,MAAD;aACR,SAAS,CAAC,IAAV,CAAe,MAAM,CAAC,GAAtB,EAA2B,MAA3B,EADQ;IAAA,CAHT;GADD,EANc;AAAA,CAAf,CArBA","file":"/server/stream/messages.coffee.js","sourcesContent":["@msgStream = new Meteor.Stream 'messages'\n\nmsgStream.permissions.write (eventName) ->\n\t# console.log('stream.permissions.write', this.userId);\n\t# return eventName == 'send' && this.userId;\n\treturn false\n\nmsgStream.permissions.read (eventName) ->\n\t# console.log('stream.permissions.read', this.userId, eventName);\n\t# return this.userId == eventName;\n\n\ttry\n\t\tcanAccess = Meteor.call 'canAccessRoom', eventName, this.userId\n\n\t\treturn false if not canAccess\n\n\t\treturn true\n\tcatch e\n\t\treturn false\n\n\nMeteor.startup ->\n\toptions = {}\n\n\tif not RocketChat.settings.get 'Message_ShowEditedStatus'\n\t\toptions.fields = { 'editedAt': 0 }\n\n\tRocketChat.models.Messages.findVisibleCreatedOrEditedAfterTimestamp(new Date(), options).observe\n\t\tadded: (record) ->\n\t\t\tmsgStream.emit record.rid, record\n\n\t\tchanged: (record) ->\n\t\t\tmsgStream.emit record.rid, record\n"]}