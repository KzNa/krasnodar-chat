{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_mentions/server.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;;;GAAA;AAAA;;AAAA;AAMc,0BAAC,OAAD;AAEZ;AAAA,eAAW,EAAX;AAAA,IACA,kBAAsB,WAAO,wBAAwB,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,uBAAxB,CAAxB,GAA2E,GAAlF,EAAuF,GAAvF,CADtB;AAAA,IAEA,OAAO,CAAC,GAAG,CAAC,OAAZ,CAAoB,eAApB,EAAqC,SAAC,KAAD,EAAQ,OAAR;aACpC,QAAQ,CAAC,IAAT,CAAc,OAAd,EADoC;IAAA,CAArC,CAFA;AAIA,QAAG,QAAQ,CAAC,MAAT,KAAqB,CAAxB;AACC,iBAAW,CAAC,CAAC,MAAF,CAAS,QAAT,CAAX;AAAA,MACA,mBAAmB,EADnB;AAAA,MAEA,QAAQ,CAAC,OAAT,CAAiB,SAAC,OAAD;AAChB;AAAA,YAAG,YAAW,KAAd;AACC,4BACC;AAAA,iBAAK,OAAL;AAAA,YACA,UAAU,OADV;WADD,CADD;SAAA;AAKC,4BAAkB,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB;AAAA,YAAC,UAAU,OAAX;WAArB,EAA0C;AAAA,YAAC,QAAQ;AAAA,cAAC,KAAK,CAAN;AAAA,cAAS,UAAU,CAAnB;aAAT;WAA1C,CAAlB,CALD;SAAA;AAOA,YAAyC,uBAAzC;iBAAA,gBAAgB,CAAC,IAAjB,CAAsB,eAAtB;SARgB;MAAA,CAAjB,CAFA;AAWA,UAAG,gBAAgB,CAAC,MAAjB,KAA6B,CAAhC;AACC,eAAO,CAAC,QAAR,GAAmB,gBAAnB,CADD;OAZD;KAJA;AAAA,IAmBA,WAAW,EAnBX;AAAA,IAoBA,kBAAsB,WAAO,wBAAwB,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,uBAAxB,CAAxB,GAA2E,GAAlF,EAAuF,GAAvF,CApBtB;AAAA,IAqBA,OAAO,CAAC,GAAG,CAAC,OAAZ,CAAoB,eAApB,EAAqC,SAAC,KAAD,EAAQ,OAAR;aACpC,QAAQ,CAAC,IAAT,CAAc,OAAd,EADoC;IAAA,CAArC,CArBA;AAwBA,QAAG,QAAQ,CAAC,MAAT,KAAqB,CAAxB;AACC,iBAAW,CAAC,CAAC,MAAF,CAAS,QAAT,CAAX;AAAA,MACA,mBAAmB,EADnB;AAAA,MAEA,QAAQ,CAAC,OAAT,CAAiB,SAAC,OAAD;AAChB;AAAA,0BAAkB,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,oBAAxB,CAA6C,OAA7C,EAAsD,GAAtD,EAA2D;AAAA,UAAE,QAAQ;AAAA,YAAC,KAAK,CAAN;AAAA,YAAS,MAAM,CAAf;WAAV;SAA3D,CAAlB;AACA,YAAyC,uBAAzC;iBAAA,gBAAgB,CAAC,IAAjB,CAAsB,eAAtB;SAFgB;MAAA,CAAjB,CAFA;AAMA,UAAG,gBAAgB,CAAC,MAAjB,KAA6B,CAAhC;AACC,eAAO,CAAC,QAAR,GAAmB,gBAAnB,CADD;OAPD;KAxBA;AAiCA,WAAO,OAAP,CAnCY;EAAA,CAAb;;wBAAA;;IAND;;AAAA,UA2CU,CAAC,SAAS,CAAC,GAArB,CAAyB,mBAAzB,EAA8C,cAA9C,EAA8D,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,IAA5F,CA3CA","file":"/packages/rocketchat_mentions.js","sourcesContent":["###\n# Mentions is a named function that will process Mentions\n# @param {Object} message - The message object\n###\n\nclass MentionsServer\n\tconstructor: (message) ->\n\t\t# If message starts with /me, replace it for text formatting\n\t\tmentions = []\n\t\tmsgMentionRegex = new RegExp '(?:^|\\\\s|\\\\n)(?:@)(' + RocketChat.settings.get('UTF8_Names_Validation') + ')', 'g'\n\t\tmessage.msg.replace msgMentionRegex, (match, mention) ->\n\t\t\tmentions.push mention\n\t\tif mentions.length isnt 0\n\t\t\tmentions = _.unique mentions\n\t\t\tverifiedMentions = []\n\t\t\tmentions.forEach (mention) ->\n\t\t\t\tif mention is 'all'\n\t\t\t\t\tverifiedMention =\n\t\t\t\t\t\t_id: mention\n\t\t\t\t\t\tusername: mention\n\t\t\t\telse\n\t\t\t\t\tverifiedMention = Meteor.users.findOne({username: mention}, {fields: {_id: 1, username: 1}})\n\n\t\t\t\tverifiedMentions.push verifiedMention if verifiedMention?\n\t\t\tif verifiedMentions.length isnt 0\n\t\t\t\tmessage.mentions = verifiedMentions\n\n\t\tchannels = []\n\t\tmsgChannelRegex = new RegExp '(?:^|\\\\s|\\\\n)(?:#)(' + RocketChat.settings.get('UTF8_Names_Validation') + ')', 'g'\n\t\tmessage.msg.replace msgChannelRegex, (match, mention) ->\n\t\t\tchannels.push mention\n\n\t\tif channels.length isnt 0\n\t\t\tchannels = _.unique channels\n\t\t\tverifiedChannels = []\n\t\t\tchannels.forEach (mention) ->\n\t\t\t\tverifiedChannel = RocketChat.models.Rooms.findOneByNameAndType(mention, 'c', { fields: {_id: 1, name: 1 } })\n\t\t\t\tverifiedChannels.push verifiedChannel if verifiedChannel?\n\n\t\t\tif verifiedChannels.length isnt 0\n\t\t\t\tmessage.channels = verifiedChannels\n\t\treturn message\n\nRocketChat.callbacks.add 'beforeSaveMessage', MentionsServer, RocketChat.callbacks.priority.HIGH\n"]}