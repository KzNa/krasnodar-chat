{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_importer-slack/server.coffee","meteor://ðŸ’»app/packages/rocketchat_importer-slack/main.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_importer-slack.js","sourcesContent":["Importer.Slack = class Importer.Slack extends Importer.Base\n\tconstructor: (name, descriptionI18N, fileTypeRegex) ->\n\t\tsuper(name, descriptionI18N, fileTypeRegex)\n\t\t@userTags = []\n\t\t@bots = {}\n\n\tprepare: (dataURI, sentContentType, fileName) =>\n\t\tsuper(dataURI, sentContentType, fileName)\n\n\t\t# try\n\t\t{image, contentType} = RocketChatFile.dataURIParse dataURI\n\t\tzip = new @AdmZip(new Buffer(image, 'base64'))\n\t\tzipEntries = zip.getEntries()\n\n\t\ttempChannels = []\n\t\ttempUsers = []\n\t\ttempMessages = {}\n\t\tfor entry in zipEntries\n\t\t\tdo (entry) =>\n\t\t\t\tif entry.entryName == 'channels.json'\n\t\t\t\t\t@updateProgress Importer.ProgressStep.PREPARING_CHANNELS\n\t\t\t\t\ttempChannels = JSON.parse entry.getData().toString()\n\t\t\t\telse if entry.entryName == 'users.json'\n\t\t\t\t\t@updateProgress Importer.ProgressStep.PREPARING_USERS\n\t\t\t\t\ttempUsers = JSON.parse entry.getData().toString()\n\n\t\t\t\t\tfor user in tempUsers when user.is_bot\n\t\t\t\t\t\t@bots[user.profile.bot_id] = user\n\n\t\t\t\telse if not entry.isDirectory and entry.entryName.indexOf('/') > -1\n\t\t\t\t\titem = entry.entryName.split('/') #random/2015-10-04.json\n\t\t\t\t\tchannelName = item[0] #random\n\t\t\t\t\tmsgGroupData = item[1].split('.')[0] #2015-10-04\n\t\t\t\t\tif not tempMessages[channelName]\n\t\t\t\t\t\ttempMessages[channelName] = {}\n\t\t\t\t\t# Catch files which aren't valid JSON files, ignore them\n\t\t\t\t\ttry\n\t\t\t\t\t\ttempMessages[channelName][msgGroupData] = JSON.parse entry.getData().toString()\n\t\t\t\t\tcatch\n\t\t\t\t\t\tconsole.warn \"#{entry.entryName} is not a valid JSON file! Unable to import it.\"\n\n\t\t# Insert the users record, eventually this might have to be split into several ones as well\n\t\t# if someone tries to import a several thousands users instance\n\t\tusersId = @collection.insert { 'import': @importRecord._id, 'importer': @name, 'type': 'users', 'users': tempUsers }\n\t\t@users = @collection.findOne usersId\n\t\t@updateRecord { 'count.users': tempUsers.length }\n\t\t@addCountToTotal tempUsers.length\n\n\t\t# Insert the channels records.\n\t\tchannelsId = @collection.insert { 'import': @importRecord._id, 'importer': @name, 'type': 'channels', 'channels': tempChannels }\n\t\t@channels = @collection.findOne channelsId\n\t\t@updateRecord { 'count.channels': tempChannels.length }\n\t\t@addCountToTotal tempChannels.length\n\n\t\t# Insert the messages records\n\t\t@updateProgress Importer.ProgressStep.PREPARING_MESSAGES\n\t\tmessagesCount = 0\n\t\tfor channel, messagesObj of tempMessages\n\t\t\tdo (channel, messagesObj) =>\n\t\t\t\tif not @messages[channel]\n\t\t\t\t\t@messages[channel] = {}\n\t\t\t\tfor date, msgs of messagesObj\n\t\t\t\t\tmessagesCount += msgs.length\n\t\t\t\t\t@updateRecord { 'messagesstatus': \"#{channel}/#{date}\" }\n\n\t\t\t\t\tif Importer.Base.getBSONSize(msgs) > Importer.Base.MaxBSONSize\n\t\t\t\t\t\tfor splitMsg, i in Importer.Base.getBSONSafeArraysFromAnArray(msgs)\n\t\t\t\t\t\t\tmessagesId = @collection.insert { 'import': @importRecord._id, 'importer': @name, 'type': 'messages', 'name': \"#{channel}/#{date}.#{i}\", 'messages': splitMsg }\n\t\t\t\t\t\t\t@messages[channel][\"#{date}.#{i}\"] = @collection.findOne messagesId\n\t\t\t\t\telse\n\t\t\t\t\t\tmessagesId = @collection.insert { 'import': @importRecord._id, 'importer': @name, 'type': 'messages', 'name': \"#{channel}/#{date}\", 'messages': msgs }\n\t\t\t\t\t\t@messages[channel][date] = @collection.findOne messagesId\n\n\t\t@updateRecord { 'count.messages': messagesCount, 'messagesstatus': null }\n\t\t@addCountToTotal messagesCount\n\n\t\tif tempUsers.length is 0 or tempChannels.length is 0 or messagesCount is 0\n\t\t\t@updateProgress Importer.ProgressStep.ERROR\n\t\t\treturn @getProgress()\n\n\t\tselectionUsers = tempUsers.map (user) ->\n\t\t\treturn new Importer.SelectionUser user.id, user.name, user.profile.email, user.deleted, user.is_bot, !user.is_bot\n\t\tselectionChannels = tempChannels.map (channel) ->\n\t\t\treturn new Importer.SelectionChannel channel.id, channel.name, channel.is_archived, true\n\n\t\t@updateProgress Importer.ProgressStep.USER_SELECTION\n\t\treturn new Importer.Selection @name, selectionUsers, selectionChannels\n\t\t# catch error\n\t\t# \t@updateRecord { 'failed': true, 'error': error }\n\t\t# \tconsole.error Importer.ProgressStep.ERROR\n\t\t# \tthrow new Error 'import-slack-error', error\n\n\tstartImport: (importSelection) =>\n\t\tsuper(importSelection)\n\t\tstart = Date.now()\n\n\t\tfor user in importSelection.users\n\t\t\tfor u in @users.users when u.id is user.user_id\n\t\t\t\tu.do_import = user.do_import\n\t\t@collection.update { _id: @users._id }, { $set: { 'users': @users.users }}\n\n\t\tfor channel in importSelection.channels\n\t\t\tfor c in @channels.channels when c.id is channel.channel_id\n\t\t\t\tc.do_import = channel.do_import\n\t\t@collection.update { _id: @channels._id }, { $set: { 'channels': @channels.channels }}\n\n\t\tstartedByUserId = Meteor.userId()\n\t\tMeteor.defer =>\n\t\t\t# try\n\t\t\t@updateProgress Importer.ProgressStep.IMPORTING_USERS\n\t\t\tfor user in @users.users when user.do_import\n\t\t\t\tdo (user) =>\n\t\t\t\t\tMeteor.runAsUser startedByUserId, () =>\n\t\t\t\t\t\texistantUser = RocketChat.models.Users.findOneByEmailAddress user.profile.email\n\t\t\t\t\t\tif existantUser\n\t\t\t\t\t\t\tuser.rocketId = existantUser._id\n\t\t\t\t\t\t\t@userTags.push\n\t\t\t\t\t\t\t\tslack: \"<@#{user.id}>\"\n\t\t\t\t\t\t\t\tslackLong: \"<@#{user.id}|#{user.name}>\"\n\t\t\t\t\t\t\t\trocket: \"@#{existantUser.username}\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tuserId = Accounts.createUser { email: user.profile.email, password: Date.now() + user.name + user.profile.email.toUpperCase() }\n\t\t\t\t\t\t\tMeteor.runAsUser userId, () =>\n\t\t\t\t\t\t\t\tMeteor.call 'setUsername', user.name\n\t\t\t\t\t\t\t\tMeteor.call 'joinDefaultChannels', true\n\t\t\t\t\t\t\t\turl = null\n\t\t\t\t\t\t\t\tif user.profile.image_original\n\t\t\t\t\t\t\t\t\turl = user.profile.image_original\n\t\t\t\t\t\t\t\telse if user.profile.image_512\n\t\t\t\t\t\t\t\t\turl = user.profile.image_512\n\t\t\t\t\t\t\t\tMeteor.call 'setAvatarFromService', url, null, 'url'\n\t\t\t\t\t\t\t\t# Slack's is -18000 which translates to Rocket.Chat's after dividing by 3600\n\t\t\t\t\t\t\t\tif user.tz_offset\n\t\t\t\t\t\t\t\t\tMeteor.call 'updateUserUtcOffset', user.tz_offset / 3600\n\n\t\t\t\t\t\t\tif user.profile.real_name\n\t\t\t\t\t\t\t\tRocketChat.models.Users.setName userId, user.profile.real_name\n\t\t\t\t\t\t\t#Deleted users are 'inactive' users in Rocket.Chat\n\t\t\t\t\t\t\tif user.deleted\n\t\t\t\t\t\t\t\tMeteor.call 'setUserActiveStatus', userId, false\n\t\t\t\t\t\t\t#TODO: Maybe send emails?\n\t\t\t\t\t\t\tuser.rocketId = userId\n\t\t\t\t\t\t\t@userTags.push\n\t\t\t\t\t\t\t\tslack: \"<@#{user.id}>\"\n\t\t\t\t\t\t\t\tslackLong: \"<@#{user.id}|#{user.name}>\"\n\t\t\t\t\t\t\t\trocket: \"@#{user.name}\"\n\t\t\t\t\t\t@addCountCompleted 1\n\t\t\t@collection.update { _id: @users._id }, { $set: { 'users': @users.users }}\n\n\t\t\t@updateProgress Importer.ProgressStep.IMPORTING_CHANNELS\n\t\t\tfor channel in @channels.channels when channel.do_import\n\t\t\t\tdo (channel) =>\n\t\t\t\t\tMeteor.runAsUser startedByUserId, () =>\n\t\t\t\t\t\texistantRoom = RocketChat.models.Rooms.findOneByName channel.name\n\t\t\t\t\t\tif existantRoom or channel.is_general\n\t\t\t\t\t\t\tif channel.is_general and channel.name isnt existantRoom?.name\n\t\t\t\t\t\t\t\tMeteor.call 'saveRoomSettings', 'GENERAL', 'roomName', channel.name\n\t\t\t\t\t\t\tchannel.rocketId = if channel.is_general then 'GENERAL' else existantRoom._id\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tusers = []\n\t\t\t\t\t\t\tfor member in channel.members when member isnt channel.creator\n\t\t\t\t\t\t\t\tuser = @getRocketUser member\n\t\t\t\t\t\t\t\tif user?\n\t\t\t\t\t\t\t\t\tusers.push user.username\n\n\t\t\t\t\t\t\tuserId = ''\n\t\t\t\t\t\t\tfor user in @users.users when user.id is channel.creator\n\t\t\t\t\t\t\t\tuserId = user.rocketId\n\n\t\t\t\t\t\t\tMeteor.runAsUser userId, () =>\n\t\t\t\t\t\t\t\treturned = Meteor.call 'createChannel', channel.name, users\n\t\t\t\t\t\t\t\tchannel.rocketId = returned.rid\n\n\t\t\t\t\t\t\t# @TODO implement model specific function\n\t\t\t\t\t\t\troomUpdate =\n\t\t\t\t\t\t\t\tts: new Date(channel.created * 1000)\n\n\t\t\t\t\t\t\tif not _.isEmpty channel.topic?.value\n\t\t\t\t\t\t\t\troomUpdate.topic = channel.topic.value\n\t\t\t\t\t\t\t\tlastSetTopic = channel.topic.last_set\n\n\t\t\t\t\t\t\tif not _.isEmpty(channel.purpose?.value) and channel.purpose.last_set > lastSetTopic\n\t\t\t\t\t\t\t\troomUpdate.topic = channel.purpose.value\n\n\t\t\t\t\t\t\tRocketChat.models.Rooms.update { _id: channel.rocketId }, { $set: roomUpdate }\n\n\t\t\t\t\t\t@addCountCompleted 1\n\t\t\t@collection.update { _id: @channels._id }, { $set: { 'channels': @channels.channels }}\n\n\t\t\tmissedTypes = {}\n\t\t\tignoreTypes = { 'bot_add': true, 'file_comment': true, 'file_mention': true, 'channel_name': true }\n\t\t\t@updateProgress Importer.ProgressStep.IMPORTING_MESSAGES\n\t\t\tfor channel, messagesObj of @messages\n\t\t\t\tdo (channel, messagesObj) =>\n\t\t\t\t\tMeteor.runAsUser startedByUserId, () =>\n\t\t\t\t\t\tslackChannel = @getSlackChannelFromName channel\n\t\t\t\t\t\tif slackChannel?.do_import\n\t\t\t\t\t\t\troom = RocketChat.models.Rooms.findOneById slackChannel.rocketId, { fields: { usernames: 1, t: 1, name: 1 } }\n\t\t\t\t\t\t\tfor date, msgs of messagesObj\n\t\t\t\t\t\t\t\t@updateRecord { 'messagesstatus': \"#{channel}/#{date}.#{msgs.messages.length}\" }\n\t\t\t\t\t\t\t\tfor message in msgs.messages\n\t\t\t\t\t\t\t\t\tif message.type is 'message'\n\t\t\t\t\t\t\t\t\t\tif message.subtype?\n\t\t\t\t\t\t\t\t\t\t\tif message.subtype is 'channel_join'\n\t\t\t\t\t\t\t\t\t\t\t\tif @getRocketUser(message.user)?\n\t\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser room._id, @getRocketUser(message.user), { ts: new Date(parseInt(message.ts.split('.')[0]) * 1000) }\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'channel_leave'\n\t\t\t\t\t\t\t\t\t\t\t\tif @getRocketUser(message.user)?\n\t\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.models.Messages.createUserLeaveWithRoomIdAndUser room._id, @getRocketUser(message.user), { ts: new Date(parseInt(message.ts.split('.')[0]) * 1000) }\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'me_message'\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.sendMessage @getRocketUser(message.user), { msg: '_' + @convertSlackMessageToRocketChat(message.text) + '_', ts: new Date(parseInt(message.ts.split('.')[0]) * 1000) }, room\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'bot_message'\n\t\t\t\t\t\t\t\t\t\t\t\tbotUser = RocketChat.models.Users.findOneById 'rocket.cat', { fields: { username: 1 }}\n\t\t\t\t\t\t\t\t\t\t\t\tbotUsername = if @bots[message.bot_id] then @bots[message.bot_id]?.name else message.username\n\t\t\t\t\t\t\t\t\t\t\t\tmsgObj =\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsg: if message.text then message.text else ''\n\t\t\t\t\t\t\t\t\t\t\t\t\tts: new Date(parseInt(message.ts.split('.')[0]) * 1000)\n\t\t\t\t\t\t\t\t\t\t\t\t\trid: room._id\n\t\t\t\t\t\t\t\t\t\t\t\t\tbot: true\n\t\t\t\t\t\t\t\t\t\t\t\t\tattachments: message.attachments\n\t\t\t\t\t\t\t\t\t\t\t\t\tusername: if botUsername then botUsername else undefined\n\n\t\t\t\t\t\t\t\t\t\t\t\tif message.edited?\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsgObj.ets = new Date(parseInt(message.edited.ts.split('.')[0]) * 1000)\n\n\t\t\t\t\t\t\t\t\t\t\t\tif message.icons?\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsgObj.emoji = message.icons.emoji\n\n\t\t\t\t\t\t\t\t\t\t\t\tmsgObj.msg = @convertSlackMessageToRocketChat(msgObj.msg)\n\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.sendMessage botUser, msgObj, room\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'channel_purpose'\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser 'room_changed_topic', room._id, message.purpose, @getRocketUser(message.user), { ts: new Date(parseInt(message.ts.split('.')[0]) * 1000) }\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'channel_topic'\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser 'room_changed_topic', room._id, message.topic, @getRocketUser(message.user), { ts: new Date(parseInt(message.ts.split('.')[0]) * 1000) }\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'pinned_item'\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.models.Messages.createWithTypeRoomIdMessageAndUser 'message_pinned', room._id, '', @getRocketUser(message.user),\n\t\t\t\t\t\t\t\t\t\t\t\t\tts: new Date(parseInt(message.ts.split('.')[0]) * 1000)\n\t\t\t\t\t\t\t\t\t\t\t\t\tattachments: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"text\" : @convertSlackMessageToRocketChat message.attachments[0].text\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"author_name\" : message.attachments[0].author_subname\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"author_icon\" : getAvatarUrlFromUsername(message.attachments[0].author_subname)\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\telse if message.subtype is 'file_share'\n\t\t\t\t\t\t\t\t\t\t\t\tif message.file?.url_private_download isnt undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetails =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: message.file.name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize: message.file.size\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: message.file.mimetype\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trid: room._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t@uploadFile details, message.file.url_private_download, @getRocketUser(message.user), room, new Date(parseInt(message.ts.split('.')[0]) * 1000)\n\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\tif not missedTypes[message.subtype] and not ignoreTypes[message.subtype]\n\t\t\t\t\t\t\t\t\t\t\t\t\tmissedTypes[message.subtype] = message\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\tuser = @getRocketUser(message.user)\n\t\t\t\t\t\t\t\t\t\t\tif user?\n\t\t\t\t\t\t\t\t\t\t\t\tmsgObj =\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsg: @convertSlackMessageToRocketChat message.text\n\t\t\t\t\t\t\t\t\t\t\t\t\tts: new Date(parseInt(message.ts.split('.')[0]) * 1000)\n\t\t\t\t\t\t\t\t\t\t\t\t\trid: room._id\n\t\t\t\t\t\t\t\t\t\t\t\t\tu:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_id: user._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tusername: user.username\n\n\t\t\t\t\t\t\t\t\t\t\t\tif message.edited?\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsgObj.ets = new Date(parseInt(message.edited.ts.split('.')[0]) * 1000)\n\n\t\t\t\t\t\t\t\t\t\t\t\tRocketChat.sendMessage @getRocketUser(message.user), msgObj, room\n\t\t\t\t\t\t\t\t\t@addCountCompleted 1\n\t\t\tconsole.log missedTypes\n\t\t\t@updateProgress Importer.ProgressStep.FINISHING\n\t\t\tfor channel in @channels.channels when channel.do_import and channel.is_archived\n\t\t\t\tdo (channel) =>\n\t\t\t\t\tMeteor.runAsUser startedByUserId, () =>\n\t\t\t\t\t\tMeteor.call 'archiveRoom', channel.rocketId\n\n\t\t\t@updateProgress Importer.ProgressStep.DONE\n\t\t\ttimeTook = Date.now() - start\n\t\t\tconsole.log \"Import took #{timeTook} milliseconds.\"\n\t\t\t# catch error\n\t\t\t# \t@updateRecord { 'failed': true, 'error': error }\n\t\t\t# \t@updateProgress Importer.ProgressStep.ERROR\n\t\t\t# \tconsole.error Importer.ProgressStep.ERROR\n\t\t\t# \tthrow new Error 'import-slack-error', error\n\n\t\treturn @getProgress()\n\n\tgetSlackChannelFromName: (channelName) =>\n\t\tfor channel in @channels.channels when channel.name is channelName\n\t\t\treturn channel\n\n\tgetRocketUser: (slackId) =>\n\t\tfor user in @users.users when user.id is slackId\n\t\t\treturn RocketChat.models.Users.findOneById user.rocketId, { fields: { username: 1 }}\n\n\tconvertSlackMessageToRocketChat: (message) =>\n\t\tif message?\n\t\t\tmessage = message.replace /<!everyone>/g, '@all'\n\t\t\tmessage = message.replace /<!channel>/g, '@all'\n\t\t\tmessage = message.replace /&gt;/g, '<'\n\t\t\tmessage = message.replace /&lt;/g, '>'\n\t\t\tmessage = message.replace /&amp;/g, '&'\n\t\t\tmessage = message.replace /:simple_smile:/g, ':smile:'\n\t\t\tmessage = message.replace /:memo:/g, ':pencil:'\n\t\t\tmessage = message.replace /:piggy:/g, ':pig:'\n\t\t\tmessage = message.replace /:uk:/g, ':gb:'\n\t\t\tmessage = message.replace /<(http[s]?:[^>]*)>/g, '$1'\n\t\t\tfor userReplace in @userTags\n\t\t\t\tmessage = message.replace userReplace.slack, userReplace.rocket\n\t\t\t\tmessage = message.replace userReplace.slackLong, userReplace.rocket\n\t\t\treturn message\n\n\tgetSelection: () =>\n\t\tselectionUsers = @users.users.map (user) ->\n\t\t\treturn new Importer.SelectionUser user.id, user.name, user.profile.email, user.deleted, user.is_bot, !user.is_bot\n\t\tselectionChannels = @channels.channels.map (channel) ->\n\t\t\treturn new Importer.SelectionChannel channel.id, channel.name, channel.is_archived, true\n\n\t\treturn new Importer.Selection @name, selectionUsers, selectionChannels\n","Importer.AddImporter 'slack', Importer.Slack,\n\tname: 'Slack'\n\tdescription: TAPi18n.__('Importer_From_Description', { from: 'Slack' })\n\tfileTypeRegex: new RegExp 'application\\/.*?zip'\n"]}